@model Agribusiness.Web.Models.SendNotificationViewModel

@{
    ViewBag.Title = "Send Notification";
    ViewBag.SubPageTitle = "Send Notification";
}

@section SubPageNavigation{
    <ul class="navigation">
        <li>
        @if (Model.NotificationTrackingViewModel.People.Count == 1)
        {
            var userId = Model.NotificationTrackingViewModel.People[0].User.Id;
            @Html.ActionLink("Back to Profile", "AdminEdit", "Person", new { id = userId, seminarId = Model.NotificationTrackingViewModel.Seminar.Id }, new { })
        }
        else
        { 
            @Html.ActionLink("Back to Seminar", "Details", "Seminar", new { id = Model.NotificationTrackingViewModel.Seminar.Id }, new { })
        }
        </li>
    </ul>
}

@section ScriptContent
{
    <script type="text/javascript" src='@Url.Script("tiny_mce/jquery.tinymce.js")'></script>
    <script type="text/javascript">
        $(function () {
            $("#EmailQueue_Body").tinymce({
                script_url: '@Url.Script("tiny_mce/tiny_mce.js")',
                width: "500",
                height: "500",

                // General options
                theme : "advanced",
                //"pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",
                plugins : "spellchecker, paste",

                // Theme options
                theme_advanced_buttons1: "bold,italic,underline,|,bullist,numlist,|,search,replace,|,preview,|,forecolor,backcolor,|,pastetext,pasteword",
                theme_advanced_buttons2 : "",
                theme_advanced_buttons3 : "",
                theme_advanced_toolbar_location : "top",
                theme_advanced_toolbar_align : "left",
                theme_advanced_statusbar_location : "bottom",
                theme_advanced_resizing : false
            });

            $(".token").click(function(){
                var val = $(this).data("value");
                $('#EmailQueue_Body').tinymce().execCommand('mceInsertContent',false,val);
            });

            $("#NotificationTracking_NotificationType").change(function(){
                var typeId = $(this).val();
                var antiForgeryToken = $("input[name='__RequestVerificationToken']").val();
                var url = '@Url.Action("LoadTemplate", "Template")';

                $.post(url, {id: typeId, __RequestVerificationToken: antiForgeryToken}, function(result){
                    if (result != "")
                    {
                        $("#EmailQueue_Body").tinymce().execCommand('mceReplaceContent', false, result);
                    }
                });
            });
        });

        function success(){debugger;}
    </script>
}

@Html.ValidationSummary(false)

@using (Html.BeginForm())
{ 
    @Html.AntiForgeryToken()

    @Html.Partial("_NotificationTracking", Model.NotificationTrackingViewModel)
    
    <fieldset>
        <legend>Notification Message</legend>
        <ul>
            <li><div class="editor-label">From Address</div>
                <div class="editor-field">@Html.TextBoxFor(a=>a.EmailQueue.FromAddress)
                    <span><em>*If blank, emails will be sent from automatedemail@caes.ucdavis.edu</em></span>
                </div>
            </li>
            <li><div class="editor-label required">Subject<span>*</span></div>
                <div class="editor-field">@Html.TextBoxFor(a=>a.EmailQueue.Subject)</div>
            </li>
            <li><div class="editor-label required">Body<span>*</span></div>
                <div class="editor-field" style="width: 85%;">
                    @Html.Partial("_TemplateTokens")
                    @Html.TextAreaFor(a=>a.EmailQueue.Body)
                </div>
            </li>
            <li><div class="editor-label">&nbsp;</div>
                <div class="editor-field">
                    <input type="submit" class="button" value="Save" />
                    |
                    @if (Model.NotificationTrackingViewModel.People.Count == 1)
                    {
                        var userId = Model.NotificationTrackingViewModel.People[0].User.Id;
                        @Html.ActionLink("Cancel", "AdminEdit", "Person", new { id = userId, seminarId = Model.NotificationTrackingViewModel.Seminar.Id }, new { })
                    }
                    else
                    { 
                        @Html.ActionLink("Cancel", "Details", "Seminar", new { id = Model.NotificationTrackingViewModel.Seminar.Id }, new { })
                    }
                </div>
            </li>
        </ul>
    </fieldset>
    
}